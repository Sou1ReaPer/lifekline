## A. 执行摘要
- 硬编码模型访问密钥泄露，且默认将用户输入的八字、姓名等直接发送至第三方代理接口，存在账户滥用与个人信息泄露风险。
- 前端未提供数据收集告知或开关，用户填写的个人命理信息默认透传到外部大模型服务，存在合规与隐私风险。

## B. 风险清单
### Critical — 硬编码 API 密钥 + 第三方代理直连
- **证据**：`services/geminiService.ts` 第 4-106 行（原始版本硬编码 `sk-...`，当前已改为环境变量）；请求直接发送到 `API_BASE_URL`。
- **影响**：一旦代码或构建产物泄露，攻击者可直接滥用密钥调用模型接口；同时请求会将用户的个人命理信息（姓名、出生年、四柱、大运）发送到第三方代理域名，存在账户被刷爆、数据外泄的双重风险。
- **修复建议**：改用环境变量注入密钥和基础域名，不在仓库存放明文密钥；默认不设置时阻断调用；优先使用官方域名或自有网关，确保 TLS 校验与访问控制。
- **最小补丁思路**：
  - 删除硬编码密钥，改为 `import.meta.env.VITE_GEMINI_API_KEY` 和 `VITE_GEMINI_API_BASE_URL`。
  - 在调用前校验变量为空时直接抛出错误，避免将请求发往未知端点。
  - 提供 `.env.example`/`.env.local` 模板，指导使用者私下配置。
- **验证方式**：静态扫描（`semgrep` 搜索 `sk-` / `Bearer` 硬编码）；运行时在未配置环境变量时应立刻报错；审查前端打包产物确保不含密钥。

### High — 个人数据未经告知即外发
- **证据**：`services/geminiService.ts` 第 46-88 行将 `name`、`birthYear`、`yearPillar` 等拼入 `userPrompt` 并发送给外部 API；前端未见任何隐私提示或同意开关。
- **影响**：用户在输入界面填写的姓名、出生年及命理信息会默认上送第三方，缺少告知与选择，可能违反最小化和合法性要求，导致合规风险。
- **修复建议**：在提交前展示隐私告知并获取用户明确同意；为姓名等可识别字段提供可选/默认空值；允许本地推理或开关外发；对上送数据做最小化和脱敏。
- **最小补丁思路**：
  - 在表单附近增加隐私提示和“同意”勾选框，未勾选时禁用提交。
  - 对 `name` 等字段默认留空并在构造 prompt 时跳过。
  - 增加配置开关以禁止向外部网络发送请求（例如要求显式设置 `VITE_ENABLE_REMOTE_AI=true`）。
- **验证方式**：前端手测提交流程；静态检查 prompt 构造；E2E 观察网络请求中是否仍含个人字段。

## C. 隐私专章
- **收集数据**：姓名（身份标识）、出生年份与四柱（身份/敏感内容）、起运年龄与大运信息（命理内容）、模型生成的分析与评分（内容数据）。
- **数据流向**：通过浏览器前端直接发送至配置的 `VITE_GEMINI_API_BASE_URL` 外部大模型接口；本地未存储持久化。
- **默认行为与开关**：无隐私提示、无显式同意；姓名字段虽可选但仍默认上送；无脱敏/采样选项；无“禁止外发”开关。
- **合规风险提示**：需遵循最小化与合法性原则；补充隐私声明与同意机制；明确数据保留与删除策略；对于第三方处理需补充委托/跨境合规说明。

## D. 供应链专章
- **依赖审计**：`package-lock.json` 存在，依赖未锁定到子依赖 patch 级别审计未执行（建议运行 `npm audit --production`）。React 19、Vite 5 版本较新，未发现明显过期主依赖。
- **构建脚本风险**：无 `curl | bash` 等远程执行脚本；生产构建依赖 Vite 标准流程。
- **CI 配置**：`.github/workflows/static.yml` 使用固定版本的官方 Actions（`actions/checkout@v4` 等），权限范围为 Pages 部署所需，未见额外高权限步骤。

## E. 快速加固清单
1) 立即轮换已泄露的 API 密钥，并从代码库与 git 历史中清除。  
2) 将模型密钥与基础域名改为环境变量注入，打包前检查产物不含密钥。  
3) 默认阻断未配置密钥/域名的调用，避免流量落入未知代理。  
4) 增加隐私告知和“同意”勾选框；未同意时不发送请求。  
5) 对姓名等可识别字段做可选/脱敏处理，默认不上送。  
6) 提供开关以禁用外部网络访问（离线/本地模式）。  
7) 对外部大模型接口配置域名白名单与 TLS 校验；避免使用不受控代理。  
8) 运行 `npm audit --production` 并修复高危依赖（如有）；保持锁文件更新。  
9) 对前端打包产物进行敏感信息扫描（密钥、URL、调试信息）。  
10) 在 README/隐私声明中列明数据收集与用途，并提供删除/退出渠道。
